{% extends "checkout/details.html" %}
{% load gross from prices %}
{% load i18n %}

{% block forms %}
    <h2>{% trans "Summary" %}</h2>

    {% include "userprofile/snippets/address-details.html" with address=checkout.billing_address %}

    <table class="table table-striped">
        <thead>
            <tr>
                <th class="col-sm-4">{% trans "Product" %}</th>
                <th class="col-sm-2">{% trans "Price" %}</th>
                <th class="col-sm-2">{% trans "Subtotal" %}</th>
                <th class="col-sm-2">{% trans "Shipping" %}</th>
                <th class="col-sm-2">{% trans "Total" %}</th>
            </tr>
        </thead>
        <tfoot>
            <tr>
                <td colspan="3" class="col-sm-8"></td>
                <th class="col-sm-2">{% trans "Total" %}:</th>
                <td class="col-sm-2">{% gross checkout.groups.get_total %}</td>
            </tr>
        </tfoot>
        <tbody>
            {% for step, group, items in checkout.enumerate_steps %}
                {% for item in items %}
                    <tr>
                        <td class="col-sm-4">{{ item.product }}{% if item.quantity != 1 %} <em>Ã—{{ item.quantity }}</em>{% endif %}</td>
                        <td class="col-sm-2">{% gross item.get_price_per_item %}</td>
                        <td class="col-sm-2">{% gross item.get_total %}</td>
                        {% if forloop.first %}
                            <td rowspan="{{ items|length }}" class="col-sm-2">
                                {% gross items.get_delivery_total %}
                                {% if group.email %}
                                    <p>{{ group.email }}</p>
                                {% elif group.address %}
                                    <p>
                                        <a class="address-details" href="#"
                                           data-content="{% if group.address.company_name %}{{ group.address.company_name }}<br>{% endif %}
                                                         {{ group.address.street_address_1 }}<br>
                                                         {% if group.address.street_address_2 %}{{ group.address.street_address_2 }}<br>{% endif %}
                                                         {{ group.address.postal_code }} {{ group.address.city }}<br>
                                                         {% if group.address.country_area %}{{ group.address.country_area }}, {% endif %}{{ group.address.get_country_display }}<br>
                                                         {{ group.address.phone }}"
                                           data-html="true" title="{{ group.address.first_name }} {{ group.address.last_name }}">{{ group.address }}</a>
                                    </p>
                                {% endif %}
                            </td>
                            <td rowspan="{{ items|length }}" class="col-sm-2">{% gross items.get_total_with_delivery %}</td>
                        {% endif %}
                    </tr>
                {% endfor %}
            {% endfor %}
        </tbody>
    </table>
    <form method="post">
        {% csrf_token %}
        <button type="submit" class="btn btn-primary">
            {% trans "Place order" %}
        </button>
    </form>
{% endblock forms %}

{% block footer_scripts %}
    {{ block.super }}
    <script type="text/javascript" src="{{ STATIC_URL }}js/order_details.js"></script>
{% endblock footer_scripts %}
