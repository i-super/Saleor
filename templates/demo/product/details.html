{% extends "base.html" %}

{% load bootstrap_form from bootstrap3 %}
{% load i18n %}
{% load gross from prices_i18n %}
{% load markdown from markdown %}
{% load price_range from price_ranges %}
{% load static from staticfiles %}

{% block title %}{{ product }} â€” {{ block.super }}{% endblock %}

{% block breadcrumb %}
    <ul class="breadcrumbs list-unstyled hidden-sm-down">
        <li><a href="/">{% trans "Home" %}</a></li>
        {% with product.get_first_category as category %}
            {% if category %}
                <li><a href="{{ category.get_absolute_url }}">{{ category }}</a></li>
            {% endif %}
        {% endwith %}
        <li><a href="{{ product.get_absolute_url }}">{{ product }}</a></li>
    </ul>
{% endblock breadcrumb %}

{% block content %}
    {% if not is_visible %}
        <div class="alert alert-warning" role="alert">
            {% blocktrans with date=product.available_on|date %}<strong>Warning!</strong> You are previewing a product that will become visible on <strong>{{ date }}</strong>.{% endblocktrans %}
        </div>
    {% endif %}
    <div itemscope itemtype="http://schema.org/Product">
        <div class="row product">
            <div class="col-sm-7 product__gallery">
              {% with images=product.images.all %}
              <div id="carousel-example-generic" class="carousel slide">
                <ol class="carousel-indicators hidden-xs-down">
                  {% for image in images %}
                  <li data-target="#carousel-example-generic" data-slide-to="{{ forloop.counter0 }}">
                    <img src="{{ image.image.crop.60x60 }}" alt="">
                  </li>
                  {% endfor %}
                </ol>
                <div class="carousel-inner" role="listbox">
                  {% for image in images %}
                  <div class="carousel-item{% if forloop.first %} active{% endif %}">
                    <img src="{{ image.image.crop.750x750 }}" alt="">
                  </div>
                  {% endfor %}
                </div>
                <a class="left carousel-control" href="#carousel-example-generic" role="button" data-slide="prev">
                  <img class="icon-next" src="{% static "img/gallery-arrow.svg" %}">
                </a>
                <a class="right carousel-control" href="#carousel-example-generic" role="button" data-slide="next">
                  <img class="icon-next" src="{% static "img/gallery-arrow.svg" %}">
                </a>
              </div>
              {% endwith %}
            </div>
            <div class="col-sm-5 product__info">
                <h1 itemprop="name" class="product__info__name">
                    {{ product }}
                </h1>
                {% if product.is_in_stock %}
                    <h2 itemprop="offers" itemscope itemtype="http://schema.org/Offer">
                        <span class="product__info__price">{% price_range price_range %}</span>
                        {% if discount %}
                            <small class="price undiscounted text-muted">{% gross undiscounted_price_range.min_price html=True %}</small>
                        {% endif %}
                        {% if local_price_range %}
                            <br>
                            <small class="text-info">
                                &asymp;
                                {% gross local_price_range.min_price html=True %}
                            </small>
                        {% endif %}
                    </h2>
                {% endif %}
                {% if is_visible and product.is_in_stock %}
                    {% block orderform %}
                    <form role="form" class="product-form form-vertical" method="post"
                     action="{% url 'cart:add-to-cart' product_id=product.pk %}?next={{ product.get_absolute_url }}" novalidate>
                        {% csrf_token %}
                        {% bootstrap_form form %}

                        <div class="form-group">
                            <button class="btn primary">
                                {% trans "Add to cart" %}
                            </button>
                        </div>
                    </form>
                    {% endblock %}
                {% else %}
                    <p class="alert alert-warning">{% trans "This product is currently <strong>unavailable</strong>." %}</p>
                {% endif %}

                <hr>

                <div itemprop="product__info__description">
                    <p><strong>{% trans "Description" %}</strong></p>
                    {{ product.description|markdown }}
                </div>

            </div>
        </div>
    </div>
{% endblock content %}
