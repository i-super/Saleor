{% extends "base.html" %}
{% load i18n %}
{% load shop %}
{% load staticfiles %}
{% load bootstrap_pagination from bootstrap3 %}
{% load render_bundle from webpack_loader %}
{% load prices_i18n %}
{% load product_first_image from product_images %}


{% block title %}{{ category }} â€” {{ block.super }}{% endblock %}

{% block breadcrumb %}
    {{ block.super }}
    {% for breadcrumb in breadcrumbs %}
        <li{% if forloop.last %} class="active"{% endif %}>
            {% if not forloop.last %}
                <a href="{{ breadcrumb.get_absolute_url }}">{{ breadcrumb }}</a>
            {% else %}
                <span>{{ breadcrumb }}</span>
            {% endif %}
        </li>
    {% endfor %}
{% endblock breadcrumb %}

{% block content %}
    <div class="category-page">
        <div class="category-top">
          <div class="row">
            <div class="col-md-7">
              <ul class="breadcrumbs list-unstyled d-none d-md-block">
                <li><a href="/">Home</a></li>
                {% if category.parent %}
                  <li key=''><a href='(( category.parent.name.get_absule_url }}'>{{ category.parent.name }}</a></li>
                {% endif %}
                <li><a href='{{ category.get_absolute_url }}'>{{ category.name }}</a></li>
              </ul>
            </div>
            <div class="col-md-5">
              <div class="row">
                  <div class="col-6 col-md-2 col-lg-6 filters-menu">
                    <span class="filters-menu__label hidden-sm-up">Filters</span>
                    <span class="filters-menu__icon hidden-sm-up"></span>

                  </div>
                  <div class="col-6 col-md-10 col-lg-6">
                    <div class="sort-by">
                      <button class="btn btn-link" onclick="changeVisibility('sort-by-box');">
                        <span>Sort by:
                          <div id='sort-by-box' class="click-area hide">
                            <strong>
                              <a href="{% get_sort_by_url 'name' %}">
                                {% trans "name" context "Product name" %}
                              </a>
                              <a href="{% get_sort_by_url 'price' %}">{% trans "price" context "Product price" %}</a>
                            </strong>
                          </div>
                        </span>
                        <div class="sort-order-icon">
                        </div>
                      </button>
                    </div>
                  </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-4 col-lg-3">
            <div class="product-filters">
              <div class="product-filters__categories">
                <h2>
                  <strong>{{ category.name }}</strong>
                </h2>
                <!--This should be dynamic if category has childs/parents-->
                <ul class="product-filters__categories__childs no-parent"></ul>
              </div>
            </div>
            <div>
              <h2>
                {% trans 'Filters' context 'Filter heading title' %}
                <span class="clear-filters float-right" onClick="">{% trans 'Clear filters' context 'Category page filters' %}</span>
              </h2>
              <div class="product-filters">
                <div class="product-filters__attributes">
                  <form method="get">
                    {% for field in filter.form %}

                        <div>
                          <h3 onclick="toggle('{{ field.name }}', '{{ field.name }}-arrow')">
                            {{ field.label }}
                            <div id="{{ field.name }}-arrow" class="collapse-filters-icon">
                              <img src="{% static "assets/chevron_up.svg" %}">
                            </div>
                          </h3>
                          <div id="{{ field.name }}" style="display:block">
                            {{ field }}
                          </div>
                        </div>

                    {% endfor %}
                    <button type="submit">Search</button>
                  </form>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-8 col-lg-9 category-list">
            <div>
              <div>
                <div class="row">
                  {% include "category/_items.html" with products=products %}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
{% endblock content %}

{% block footer_scripts %}
  {{ block.super }}
  <script type="text/javascript">
    function toggle(showHideDiv, switchImgTag) {
      var ele = document.getElementById(showHideDiv);
      var imageEle = document.getElementById(switchImgTag);
      if(ele.style.display == "block") {
        ele.style.display = "none";
		    imageEle.innerHTML = '<img src="{% static "assets/chevron_down.svg" %}">';
      } else {
        ele.style.display = "block";
        imageEle.innerHTML = '<img src="{% static "assets/chevron_up.svg" %}">';
      }
    }

    function changeVisibility(showHideDiv) {
      var ele = document.getElementById(showHideDiv);
      var imageEle = document.getElementById(switchImgTag);

      if(ele.className.match(/(?:^|\s)hide(?!\S)/) {
        ele.className = ele.className.replace( /(?:^|\s)hide(?!\S)/g , '' );
      } else {
        ele.className += " hide";
      }
    }
  </script>
{% endblock footer_scripts %}
