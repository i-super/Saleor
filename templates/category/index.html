{% extends "base.html" %}
{% load i18n %}
{% load shop %}
{% load staticfiles %}
{% load bootstrap_pagination from bootstrap3 %}
{% load render_bundle from webpack_loader %}
{% load prices_i18n %}
{% load product_first_image from product_images %}

{% block footer_scripts %}
  {{ block.super }}
{% endblock footer_scripts %}

{% block title %}{{ category }} â€” {{ block.super }}{% endblock %}

{% block breadcrumb %}
    {{ block.super }}
    {% for breadcrumb in breadcrumbs %}
        <li{% if forloop.last %} class="active"{% endif %}>
            {% if not forloop.last %}
                <a href="{{ breadcrumb.get_absolute_url }}">{{ breadcrumb }}</a>
            {% else %}
                <span>{{ breadcrumb }}</span>
            {% endif %}
        </li>
    {% endfor %}
{% endblock breadcrumb %}

{% block content %}
    <div class="category-page">
        <div class="category-top">
          <div class="row">
            <div class="col-md-7">
              <ul class="breadcrumbs list-unstyled d-none d-md-block">
                <li><a href="/">Home</a></li>
                {% if category.parent %}
                  <li key=''><a href='(( category.parent.name.get_absule_url }}'>{{ category.parent.name }}</a></li>
                {% endif %}
                <li><a href='{{ category.get_absolute_url }}'>{{ category.name }}</a></li>
              </ul>
            </div>
            <div class="col-md-5">
              <div class="row">
                  <div class="col-6 col-md-2 col-lg-6 filters-menu">
                    <span class="filters-menu__label hidden-sm-up">Filters</span>
                    <span class="filters-menu__icon hidden-sm-up"></span>
                  </div>
                  <div class="col-6 col-md-10 col-lg-6">
                    <div class="sort-by">
                      <span>Sort by:
                        <strong>
                          <a href="{% get_sort_by_url 'name' %}" onclick="toggleSort('name-arrow')">
                            {% trans "name" context "Product name" %}
                          </a>
                          {% if request.GET.sort_by == 'name' %}
                            <div class="sort-order-icon"><img src="{% static "assets/arrow_up.svg" %}"></div>
                          {% elif request.GET.sort_by == '-name' %}
                            <div class="sort-order-icon"><img src="{% static "assets/arrow_down.svg" %}"></div>
                          {% else %}
                          {% endif %}
                          <a href="{% get_sort_by_url 'price' %}" onclick="toggleSort('price-arrow')">
                            {% trans "price" context "Product price" %}
                          </a>
                          {% if request.GET.sort_by == 'price' %}
                            <div class="sort-order-icon"><img src="{% static "assets/arrow_up.svg" %}"></div>
                          {% elif request.GET.sort_by == '-price' %}
                            <div class="sort-order-icon"><img src="{% static "assets/arrow_down.svg" %}"></div>
                          {% else %}
                          {% endif %}
                        </strong>
                      </span>
                      <div class="sort-order-icon">
                      </div>
                    </div>
                  </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-4 col-lg-3">
            <div class="product-filters">
              <div class="product-filters__categories">
                <h2>
                  <strong>{{ category.name }}</strong>
                </h2>
                <!--This should be dynamic if category has childs/parents-->
                <ul class="product-filters__categories__childs no-parent"></ul>
              </div>
            </div>
            <div>
              <h2>
                {% trans 'Filters' context 'Filter heading title' %}
                <span class="clear-filters float-right" onClick="">{% trans 'Clear filters' context 'Category page filters' %}</span>
              </h2>
              <div class="product-filters">
                <div class="product-filters__attributes">
                  <form method="get">
                    {% for field in filter.form %}
                      {% if field.label == 'Price' %}
                        <div class="toggle-filter product-filters__price-range">
                          <h3 class="filter-label">
                            {{ field.label }}
                            <div class="collapse-filters-icon">
                              <img src="{% static "assets/chevron_up.svg" %}">
                            </div>
                          </h3>
                          <div class="filter-form-field" style="display:block">
                            {{ field }}
                          </div>
                        </div>
                      {% elif field.label == 'Sort by' %}
                      {% else %}
                        <div class="toggle-filter">
                          <h3 class="filter-label">
                            {{ field.label }}
                            <div class="collapse-filters-icon">
                              <img src="{% static "assets/chevron_up.svg" %}">
                            </div>
                          </h3>
                          <div class="filter-form-field" style="display:block">
                            {{ field }}
                          </div>
                        </div>
                      {% endif %}
                    {% endfor %}
                    <button class="btn primary" type="submit">Search</button>
                  </form>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-8 col-lg-9 category-list">
            <div>
              <div>
                <div class="row">
                  {% include "category/_items.html" with products=products %}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
{% endblock content %}
